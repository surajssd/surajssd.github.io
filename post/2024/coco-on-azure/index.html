<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Open Source Confidential Containers (CoCo) on Azure | Suraj Deshmukh</title>
<meta name="keywords" content="kubernetes, security, coco">
<meta name="description" content="Explore how Azure‚Äôs support for nested confidential compute unlocks a straightforward path to deploying Confidential Containers (CoCo), ensuring enhanced data security in the cloud with ease.">
<meta name="author" content="Suraj Deshmukh">
<link rel="canonical" href="https://suraj.io/post/2024/coco-on-azure/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://suraj.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://suraj.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://suraj.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://suraj.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://suraj.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://suraj.io/post/2024/coco-on-azure/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-97006720-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Open Source Confidential Containers (CoCo) on Azure" />
<meta property="og:description" content="Explore how Azure‚Äôs support for nested confidential compute unlocks a straightforward path to deploying Confidential Containers (CoCo), ensuring enhanced data security in the cloud with ease." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://suraj.io/post/2024/coco-on-azure/" />
<meta property="og:image" content="https://suraj.io/post/2024/images/coco-on-azure.png" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-04-05T09:21:07+05:30" />
<meta property="article:modified_time" content="2024-04-05T09:21:07+05:30" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://suraj.io/post/2024/images/coco-on-azure.png" />
<meta name="twitter:title" content="Open Source Confidential Containers (CoCo) on Azure"/>
<meta name="twitter:description" content="Explore how Azure‚Äôs support for nested confidential compute unlocks a straightforward path to deploying Confidential Containers (CoCo), ensuring enhanced data security in the cloud with ease."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://suraj.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Open Source Confidential Containers (CoCo) on Azure",
      "item": "https://suraj.io/post/2024/coco-on-azure/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Open Source Confidential Containers (CoCo) on Azure",
  "name": "Open Source Confidential Containers (CoCo) on Azure",
  "description": "Explore how Azure‚Äôs support for nested confidential compute unlocks a straightforward path to deploying Confidential Containers (CoCo), ensuring enhanced data security in the cloud with ease.",
  "keywords": [
    "kubernetes", "security", "coco"
  ],
  "articleBody": "Introduction In the realm of cloud computing, ensuring data privacy and security is paramount, yet profoundly challenging. One innovative solution to this challenge is Confidential Containers (CoCo)1, designed to provide an extra layer of security for data in use. However, deploying CoCo requires access to specialized hardware, which adds complexity. Beyond just finding the right hardware, the setup involves navigating a maze of technical specifications ‚Äì from BIOS configurations to kernel versions ‚Äì making the process daunting.\nEnter Azure‚Äôs nested confidential compute2 for AMD SEV-SNP, a breakthrough in making CoCo more accessible and manageable. This blog post will guide you through leveraging Azure‚Äôs support to deploy CoCo-based workloads with ease. You‚Äôll learn not only how to navigate the setup process but also how Azure simplifies the deployment. Whether you‚Äôre a seasoned cloud professional or new to the concept of confidential computing, this post will provide valuable insights into making the most of CoCo on Azure.\nHere is how we will achieve this installation:\nProcure an Azure VM capable of running nested confidential compute Install single-node Kubernetes cluster Install CoCo Run sample workload 1: Nested Confidential Compute Capable VM 1.1: Export Environment Variables Export the following environment variables, you can make changes as you deem necessary:\nexport RESOURCE_GROUP=\"coco-on-azure\" export VM_NAME=\"${RESOURCE_GROUP}\" export SSH_PRIV_KEY=\"~/.ssh/id_rsa\" export SSH_KEY=\"${SSH_PRIV_KEY}.pub\" export USER_NAME=\"azure\" Export these environment variables as necessary:\nNote: You can choose a bigger machine type exported in the environment variable VM_SIZE. You can find other machine types here3.\nexport VM_IMAGE=\"/CommunityGalleries/cocopreview-91c44057-c3ab-4652-bf00-9242d5a90170/Images/ubuntu2004-snp-host/Versions/latest\" export LOCATION=\"eastus\" export VM_SIZE=\"Standard_DC8as_cc_v5\" Kudos to Jeremi Piotrowski for building the host OS image.\n1.2: Create Azure Resource Group Note: You can skip this step if you already have a resource group you use.\naz group create \\ --name \"${RESOURCE_GROUP}\" \\ --location \"${LOCATION}\" 1.3: Deploy the VM az vm create \\ --resource-group \"${RESOURCE_GROUP}\" \\ --size \"${VM_SIZE}\" \\ --name \"${VM_NAME}\" \\ --location \"${LOCATION}\" \\ --admin-username \"${USER_NAME}\" \\ --ssh-key-values \"${SSH_KEY}\" \\ --authentication-type ssh \\ --image \"${VM_IMAGE}\" \\ --public-ip-address-dns-name \"${VM_NAME}\" \\ --os-disk-size-gb 300 \\ --accelerated-networking true \\ --accept-term 1.4: SSH into the VM eval \"ssh -i ${SSH_PRIV_KEY} ${USER_NAME}@${VM_NAME}.${LOCATION}.cloudapp.azure.com\" 2: Install Single-Node Kubernetes Cluster Following instructions were created based on the official Kubernetes documentation4 and Docker documentation5.\n2.1: Install Prerequisites sudo apt-get update sudo apt-get install -y gdb binutils apt-transport-https ca-certificates curl gpg 2.2: Configure Docker Repository sudo install -m 0755 -d /etc/apt/keyrings sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc sudo chmod a+r /etc/apt/keyrings/docker.asc echo \\ \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\ $(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e/dev/null 2.3: Configure Kubernetes Repository curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list 2.4: Install Docker \u0026 Kubernetes sudo apt-get update sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin kubelet kubeadm kubectl sudo apt-mark hold kubelet kubeadm kubectl 2.5: Start Containerd Daemon containerd config default | sudo tee /etc/containerd/config.toml sudo systemctl restart containerd sudo systemctl enable --now containerd sudo systemctl enable --now docker sudo docker run hello-world 2.6: Disable Swap Since this machine is acting as both control-plane and the worker node, so disable swap.\nsudo swapoff -a sudo cp /etc/fstab /etc/fstab.bak sudo sed -i '/\\bswap\\b/d' /etc/fstab 2.7: Ensure Networking is Configured sudo modprobe overlay sudo modprobe br_netfilter cat \u003c",
  "wordCount" : "1030",
  "inLanguage": "en",
  "image":"https://suraj.io/post/2024/images/coco-on-azure.png","datePublished": "2024-04-05T09:21:07+05:30",
  "dateModified": "2024-04-05T09:21:07+05:30",
  "author":{
    "@type": "Person",
    "name": "Suraj Deshmukh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://suraj.io/post/2024/coco-on-azure/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Suraj Deshmukh",
    "logo": {
      "@type": "ImageObject",
      "url": "https://suraj.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://suraj.io/" accesskey="h" title="Suraj Deshmukh (Alt + H)">Suraj Deshmukh</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://suraj.io/post" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/archives" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/series" title="Series">
                    <span>Series</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/search" title="Search üîç">
                    <span>Search üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://suraj.io/">Home</a>&nbsp;¬ª&nbsp;<a href="https://suraj.io/post/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Open Source Confidential Containers (CoCo) on Azure
    </h1>
    <div class="post-description">
      Explore how Azure‚Äôs support for nested confidential compute unlocks a straightforward path to deploying Confidential Containers (CoCo), ensuring enhanced data security in the cloud with ease.
    </div>
    <div class="post-meta"><span title='2024-04-05 09:21:07 +0530 +0530'>April 5, 2024</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Suraj Deshmukh&nbsp;|&nbsp;<a href="https://github.com/surajssd/blog_contents/blob/master/content/post/2024/coco-on-azure.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="https://suraj.io/post/2024/images/coco-on-azure.png" alt="CoCo on Azure">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#1-nested-confidential-compute-capable-vm" aria-label="1: Nested Confidential Compute Capable VM">1: Nested Confidential Compute Capable VM</a><ul>
                        
                <li>
                    <a href="#11-export-environment-variables" aria-label="1.1: Export Environment Variables">1.1: Export Environment Variables</a></li>
                <li>
                    <a href="#12-create-azure-resource-group" aria-label="1.2: Create Azure Resource Group">1.2: Create Azure Resource Group</a></li>
                <li>
                    <a href="#13-deploy-the-vm" aria-label="1.3: Deploy the VM">1.3: Deploy the VM</a></li>
                <li>
                    <a href="#14-ssh-into-the-vm" aria-label="1.4: SSH into the VM">1.4: SSH into the VM</a></li></ul>
                </li>
                <li>
                    <a href="#2-install-single-node-kubernetes-cluster" aria-label="2: Install Single-Node Kubernetes Cluster">2: Install Single-Node Kubernetes Cluster</a><ul>
                        
                <li>
                    <a href="#21-install-prerequisites" aria-label="2.1: Install Prerequisites">2.1: Install Prerequisites</a></li>
                <li>
                    <a href="#22-configure-docker-repository" aria-label="2.2: Configure Docker Repository">2.2: Configure Docker Repository</a></li>
                <li>
                    <a href="#23-configure-kubernetes-repository" aria-label="2.3: Configure Kubernetes Repository">2.3: Configure Kubernetes Repository</a></li>
                <li>
                    <a href="#24-install-docker--kubernetes" aria-label="2.4: Install Docker &amp; Kubernetes">2.4: Install Docker &amp; Kubernetes</a></li>
                <li>
                    <a href="#25-start-containerd-daemon" aria-label="2.5: Start Containerd Daemon">2.5: Start Containerd Daemon</a></li>
                <li>
                    <a href="#26-disable-swap" aria-label="2.6: Disable Swap">2.6: Disable Swap</a></li>
                <li>
                    <a href="#27-ensure-networking-is-configured" aria-label="2.7: Ensure Networking is Configured">2.7: Ensure Networking is Configured</a></li>
                <li>
                    <a href="#28-initialize-kubeadm" aria-label="2.8: Initialize Kubeadm">2.8: Initialize Kubeadm</a></li>
                <li>
                    <a href="#29-configure-kubernetes-config" aria-label="2.9: Configure Kubernetes Config">2.9: Configure Kubernetes Config</a></li>
                <li>
                    <a href="#210-install-cni" aria-label="2.10: Install CNI">2.10: Install CNI</a></li>
                <li>
                    <a href="#211-ensure-single-node-acts-as-control-plane-and-worker" aria-label="2.11: Ensure Single-Node Acts as Control Plane and Worker">2.11: Ensure Single-Node Acts as Control Plane and Worker</a></li></ul>
                </li>
                <li>
                    <a href="#3-install-confidential-containers-coco-using-operator" aria-label="3: Install Confidential Containers (CoCo) Using Operator">3: Install Confidential Containers (CoCo) Using Operator</a><ul>
                        
                <li>
                    <a href="#31-install-operator" aria-label="3.1: Install Operator">3.1: Install Operator</a></li>
                <li>
                    <a href="#32-verify-runtimeclasses-availability" aria-label="3.2: Verify Runtimeclasses Availability">3.2: Verify Runtimeclasses Availability</a></li></ul>
                </li>
                <li>
                    <a href="#4-run-sample-application" aria-label="4. Run Sample Application">4. Run Sample Application</a><ul>
                        
                <li>
                    <a href="#41-run-nginx-in-tee" aria-label="4.1: Run Nginx in TEE">4.1: Run Nginx in TEE</a></li>
                <li>
                    <a href="#42-verify-pod-is-running" aria-label="4.2: Verify Pod is Running">4.2: Verify Pod is Running</a></li>
                <li>
                    <a href="#42-verify-pod-is-running-in-tee" aria-label="4.2: Verify Pod is Running in TEE">4.2: Verify Pod is Running in TEE</a></li></ul>
                </li>
                <li>
                    <a href="#wrapping-up" aria-label="Wrapping Up">Wrapping Up</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>In the realm of cloud computing, ensuring data privacy and security is paramount, yet profoundly challenging. One innovative solution to this challenge is <a href="https://confidentialcontainers.org/">Confidential Containers (CoCo)</a><cite><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></cite>, designed to provide an extra layer of security for data in use. However, deploying CoCo requires access to specialized hardware, which adds complexity. Beyond just finding the right hardware, the setup involves navigating a maze of technical specifications ‚Äì from BIOS configurations to kernel versions ‚Äì making the process daunting.</p>
<p>Enter Azure&rsquo;s <a href="https://techcommunity.microsoft.com/t5/apps-on-azure-blog/public-preview-confidential-containers-on-aks/ba-p/3980871">nested confidential compute</a><cite><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></cite> for AMD SEV-SNP, a breakthrough in making CoCo more accessible and manageable. This blog post will guide you through leveraging Azure&rsquo;s support to deploy CoCo-based workloads with ease. You&rsquo;ll learn not only how to navigate the setup process but also how Azure simplifies the deployment. Whether you&rsquo;re a seasoned cloud professional or new to the concept of confidential computing, this post will provide valuable insights into making the most of CoCo on Azure.</p>
<p>Here is how we will achieve this installation:</p>
<ol>
<li>Procure an Azure VM capable of running nested confidential compute</li>
<li>Install single-node Kubernetes cluster</li>
<li>Install CoCo</li>
<li>Run sample workload</li>
</ol>
<h2 id="1-nested-confidential-compute-capable-vm">1: Nested Confidential Compute Capable VM<a hidden class="anchor" aria-hidden="true" href="#1-nested-confidential-compute-capable-vm">#</a></h2>
<h3 id="11-export-environment-variables">1.1: Export Environment Variables<a hidden class="anchor" aria-hidden="true" href="#11-export-environment-variables">#</a></h3>
<p>Export the following environment variables, you can make changes as you deem necessary:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">&#34;coco-on-azure&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VM_NAME</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">RESOURCE_GROUP</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SSH_PRIV_KEY</span><span class="o">=</span><span class="s2">&#34;~/.ssh/id_rsa&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SSH_KEY</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SSH_PRIV_KEY</span><span class="si">}</span><span class="s2">.pub&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">USER_NAME</span><span class="o">=</span><span class="s2">&#34;azure&#34;</span>
</span></span></code></pre></div><p>Export these environment variables as necessary:</p>
<blockquote>
<p><strong>Note</strong>: You can choose a bigger machine type exported in the environment variable <code>VM_SIZE</code>. You can find other machine types <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/dcasccv5-dcadsccv5-series">here</a><cite><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></cite>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VM_IMAGE</span><span class="o">=</span><span class="s2">&#34;/CommunityGalleries/cocopreview-91c44057-c3ab-4652-bf00-9242d5a90170/Images/ubuntu2004-snp-host/Versions/latest&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LOCATION</span><span class="o">=</span><span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VM_SIZE</span><span class="o">=</span><span class="s2">&#34;Standard_DC8as_cc_v5&#34;</span>
</span></span></code></pre></div><blockquote>
<p><em>Kudos to <a href="https://github.com/jepio">Jeremi Piotrowski</a> for building the host OS image.</em></p>
</blockquote>
<h3 id="12-create-azure-resource-group">1.2: Create Azure Resource Group<a hidden class="anchor" aria-hidden="true" href="#12-create-azure-resource-group">#</a></h3>
<blockquote>
<p><strong>Note</strong>: You can skip this step if you already have a resource group you use.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">az group create <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RESOURCE_GROUP</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --location <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></div><h3 id="13-deploy-the-vm">1.3: Deploy the VM<a hidden class="anchor" aria-hidden="true" href="#13-deploy-the-vm">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">az vm create <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --resource-group <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RESOURCE_GROUP</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --size <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VM_SIZE</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --location <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --admin-username <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER_NAME</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --ssh-key-values <span class="s2">&#34;</span><span class="si">${</span><span class="nv">SSH_KEY</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --authentication-type ssh <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --image <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VM_IMAGE</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --public-ip-address-dns-name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --os-disk-size-gb <span class="m">300</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --accelerated-networking <span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --accept-term
</span></span></code></pre></div><h3 id="14-ssh-into-the-vm">1.4: SSH into the VM<a hidden class="anchor" aria-hidden="true" href="#14-ssh-into-the-vm">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">eval</span> <span class="s2">&#34;ssh -i </span><span class="si">${</span><span class="nv">SSH_PRIV_KEY</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">USER_NAME</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span><span class="s2">.cloudapp.azure.com&#34;</span>
</span></span></code></pre></div><h2 id="2-install-single-node-kubernetes-cluster">2: Install Single-Node Kubernetes Cluster<a hidden class="anchor" aria-hidden="true" href="#2-install-single-node-kubernetes-cluster">#</a></h2>
<p>Following instructions were created based on the official <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Kubernetes documentation</a><cite><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></cite> and <a href="https://docs.docker.com/engine/install/ubuntu/">Docker documentation</a><cite><sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></cite>.</p>
<h3 id="21-install-prerequisites">2.1: Install Prerequisites<a hidden class="anchor" aria-hidden="true" href="#21-install-prerequisites">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install -y gdb binutils apt-transport-https ca-certificates curl gpg
</span></span></code></pre></div><h3 id="22-configure-docker-repository">2.2: Configure Docker Repository<a hidden class="anchor" aria-hidden="true" href="#22-configure-docker-repository">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo install -m <span class="m">0755</span> -d /etc/apt/keyrings
</span></span><span class="line"><span class="cl">sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
</span></span><span class="line"><span class="cl">sudo chmod a+r /etc/apt/keyrings/docker.asc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="s2">&#34;deb [arch=</span><span class="k">$(</span>dpkg --print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
</span></span></span><span class="line"><span class="cl"><span class="s2">  </span><span class="k">$(</span>. /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$VERSION_CODENAME</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2"> stable&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">  sudo tee /etc/apt/sources.list.d/docker.list &gt;/dev/null
</span></span></code></pre></div><h3 id="23-configure-kubernetes-repository">2.3: Configure Kubernetes Repository<a hidden class="anchor" aria-hidden="true" href="#23-configure-kubernetes-repository">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key <span class="p">|</span> sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /&#39;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span></code></pre></div><h3 id="24-install-docker--kubernetes">2.4: Install Docker &amp; Kubernetes<a hidden class="anchor" aria-hidden="true" href="#24-install-docker--kubernetes">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin kubelet kubeadm kubectl
</span></span><span class="line"><span class="cl">sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></div><h3 id="25-start-containerd-daemon">2.5: Start Containerd Daemon<a hidden class="anchor" aria-hidden="true" href="#25-start-containerd-daemon">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">containerd config default <span class="p">|</span> sudo tee /etc/containerd/config.toml
</span></span><span class="line"><span class="cl">sudo systemctl restart containerd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> --now containerd
</span></span><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> --now docker
</span></span><span class="line"><span class="cl">sudo docker run hello-world
</span></span></code></pre></div><h3 id="26-disable-swap">2.6: Disable Swap<a hidden class="anchor" aria-hidden="true" href="#26-disable-swap">#</a></h3>
<p>Since this machine is acting as both control-plane and the worker node, so disable swap.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo swapoff -a
</span></span><span class="line"><span class="cl">sudo cp /etc/fstab /etc/fstab.bak
</span></span><span class="line"><span class="cl">sudo sed -i <span class="s1">&#39;/\bswap\b/d&#39;</span> /etc/fstab
</span></span></code></pre></div><h3 id="27-ensure-networking-is-configured">2.7: Ensure Networking is Configured<a hidden class="anchor" aria-hidden="true" href="#27-ensure-networking-is-configured">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo modprobe overlay
</span></span><span class="line"><span class="cl">sudo modprobe br_netfilter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span class="line"><span class="cl"><span class="s">overlay
</span></span></span><span class="line"><span class="cl"><span class="s">br_netfilter
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class="line"><span class="cl"><span class="s1">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class="line"><span class="cl"><span class="s1">net.ipv4.ip_forward = 1
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;</span> <span class="p">|</span> sudo tee /etc/sysctl.d/k8s.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo sysctl --system
</span></span></code></pre></div><h3 id="28-initialize-kubeadm">2.8: Initialize Kubeadm<a hidden class="anchor" aria-hidden="true" href="#28-initialize-kubeadm">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">kind: ClusterConfiguration
</span></span></span><span class="line"><span class="cl"><span class="s1">apiVersion: kubeadm.k8s.io/v1beta3
</span></span></span><span class="line"><span class="cl"><span class="s1">networking:
</span></span></span><span class="line"><span class="cl"><span class="s1">  podSubnet: &#34;192.168.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">---
</span></span></span><span class="line"><span class="cl"><span class="s1">kind: KubeletConfiguration
</span></span></span><span class="line"><span class="cl"><span class="s1">apiVersion: kubelet.config.k8s.io/v1beta1
</span></span></span><span class="line"><span class="cl"><span class="s1">cgroupDriver: systemd
</span></span></span><span class="line"><span class="cl"><span class="s1">podCIDR: &#34;192.168.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;</span> <span class="p">|</span> tee kubeadm-config.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo kubeadm config images pull
</span></span><span class="line"><span class="cl">sudo kubeadm init --config kubeadm-config.yaml
</span></span></code></pre></div><h3 id="29-configure-kubernetes-config">2.9: Configure Kubernetes Config<a hidden class="anchor" aria-hidden="true" href="#29-configure-kubernetes-config">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span></code></pre></div><h3 id="210-install-cni">2.10: Install CNI<a hidden class="anchor" aria-hidden="true" href="#210-install-cni">#</a></h3>
<p>Following Calico installation steps were taken from the official <a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart#install-calico">Calico documentation</a><cite><sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></cite>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.3/manifests/tigera-operator.yaml
</span></span><span class="line"><span class="cl">kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.3/manifests/custom-resources.yaml
</span></span></code></pre></div><h3 id="211-ensure-single-node-acts-as-control-plane-and-worker">2.11: Ensure Single-Node Acts as Control Plane and Worker<a hidden class="anchor" aria-hidden="true" href="#211-ensure-single-node-acts-as-control-plane-and-worker">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl taint nodes --all node-role.kubernetes.io/control-plane-
</span></span></code></pre></div><h2 id="3-install-confidential-containers-coco-using-operator">3: Install Confidential Containers (CoCo) Using Operator<a hidden class="anchor" aria-hidden="true" href="#3-install-confidential-containers-coco-using-operator">#</a></h2>
<h3 id="31-install-operator">3.1: Install Operator<a hidden class="anchor" aria-hidden="true" href="#31-install-operator">#</a></h3>
<p>CoCo operator installation steps are taken from <a href="https://github.com/confidential-containers/operator/blob/main/docs/INSTALL.md">this official documentation</a><cite><sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup><cite>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">COCO_OPERATOR_VERSION</span><span class="o">=</span><span class="s2">&#34;0.8.0&#34;</span>
</span></span><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/confidential-containers/operator/config/release?ref=v</span><span class="si">${</span><span class="nv">COCO_OPERATOR_VERSION</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/confidential-containers/operator/config/samples/ccruntime/default?ref=v</span><span class="si">${</span><span class="nv">COCO_OPERATOR_VERSION</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl label nodes --all node.kubernetes.io/worker<span class="o">=</span>
</span></span></code></pre></div><blockquote>
<p><strong>Note</strong>: Find the latest release of the Confidential Containers from the <a href="https://github.com/confidential-containers/operator/releases">project release page</a><cite><sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup><cite>.</p>
</blockquote>
<h3 id="32-verify-runtimeclasses-availability">3.2: Verify Runtimeclasses Availability<a hidden class="anchor" aria-hidden="true" href="#32-verify-runtimeclasses-availability">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get runtimeclass
</span></span></code></pre></div><p>A sample output would look like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> kubectl get runtimeclass
</span></span><span class="line"><span class="cl"><span class="go">NAME            HANDLER         AGE
</span></span></span><span class="line"><span class="cl"><span class="go">kata            kata-qemu       26s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-clh        kata-clh        37s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-clh-tdx    kata-clh-tdx    30s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-qemu       kata-qemu       30s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-qemu-sev   kata-qemu-sev   26s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-qemu-snp   kata-qemu-snp   26s
</span></span></span><span class="line"><span class="cl"><span class="go">kata-qemu-tdx   kata-qemu-tdx   26s
</span></span></span></code></pre></div><h2 id="4-run-sample-application">4. Run Sample Application<a hidden class="anchor" aria-hidden="true" href="#4-run-sample-application">#</a></h2>
<h3 id="41-run-nginx-in-tee">4.1: Run Nginx in TEE<a hidden class="anchor" aria-hidden="true" href="#41-run-nginx-in-tee">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">apiVersion: apps/v1
</span></span></span><span class="line"><span class="cl"><span class="s1">kind: Deployment
</span></span></span><span class="line"><span class="cl"><span class="s1">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s1">  name: nginx-snp
</span></span></span><span class="line"><span class="cl"><span class="s1">  namespace: default
</span></span></span><span class="line"><span class="cl"><span class="s1">spec:
</span></span></span><span class="line"><span class="cl"><span class="s1">  selector:
</span></span></span><span class="line"><span class="cl"><span class="s1">    matchLabels:
</span></span></span><span class="line"><span class="cl"><span class="s1">      app: nginx
</span></span></span><span class="line"><span class="cl"><span class="s1">  replicas: 1
</span></span></span><span class="line"><span class="cl"><span class="s1">  template:
</span></span></span><span class="line"><span class="cl"><span class="s1">    metadata:
</span></span></span><span class="line"><span class="cl"><span class="s1">      labels:
</span></span></span><span class="line"><span class="cl"><span class="s1">        app: nginx
</span></span></span><span class="line"><span class="cl"><span class="s1">    spec:
</span></span></span><span class="line hl"><span class="cl"><span class="s1">      runtimeClassName: kata-qemu-snp
</span></span></span><span class="line"><span class="cl"><span class="s1">      containers:
</span></span></span><span class="line"><span class="cl"><span class="s1">      - name: nginx
</span></span></span><span class="line"><span class="cl"><span class="s1">        image: nginx
</span></span></span><span class="line"><span class="cl"><span class="s1">        ports:
</span></span></span><span class="line"><span class="cl"><span class="s1">        - containerPort: 80
</span></span></span><span class="line"><span class="cl"><span class="s1">        imagePullPolicy: Always
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;</span> <span class="p">|</span> kubectl apply -f -
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-verify-pod-is-running">4.2: Verify Pod is Running<a hidden class="anchor" aria-hidden="true" href="#42-verify-pod-is-running">#</a></h3>
<p>Ensure that the pod is running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods
</span></span></code></pre></div><h3 id="42-verify-pod-is-running-in-tee">4.2: Verify Pod is Running in TEE<a hidden class="anchor" aria-hidden="true" href="#42-verify-pod-is-running-in-tee">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ps aux <span class="p">|</span> grep qemu
</span></span></code></pre></div><h2 id="wrapping-up">Wrapping Up<a hidden class="anchor" aria-hidden="true" href="#wrapping-up">#</a></h2>
<p>Today, we&rsquo;ve learnt the deployment of Confidential Containers (CoCo) on Azure, moving beyond the limitations of specialized hardware and complex setups. By harnessing Azure&rsquo;s nested confidential compute capabilities, we&rsquo;ve showcased an easier path to get started with CoCo. We started with setting up a conducive environment on Azure, configuring a single-node Kubernetes cluster, installing CoCo, and finally, deploying a sample application.</p>
<p>As we look forward, the natural progression is to delve into the possibilities with Azure Kubernetes Service (AKS) for deploying CoCo. This exploration is just the beginning. The realm of confidential computing is vast and full of potential. As you continue to experiment and learn, let this experience serve as a foundation for your future projects, driving home the importance of security in our increasingly cloud-centric world.</p>
<p>Happy hacking, and here&rsquo;s to elevating the security of your cloud workloads to new heights!</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Official Confidential Containers Website: <a href="https://confidentialcontainers.org/">https://confidentialcontainers.org/</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Public preview: Confidential containers on AKS <a href="https://techcommunity.microsoft.com/t5/apps-on-azure-blog/public-preview-confidential-containers-on-aks/ba-p/3980871">https://techcommunity.microsoft.com/t5/apps-on-azure-blog/public-preview-confidential-containers-on-aks/ba-p/3980871</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>DCas_cc_v5 and DCads_cc_v5-series (Preview) <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/dcasccv5-dcadsccv5-series">https://learn.microsoft.com/en-us/azure/virtual-machines/dcasccv5-dcadsccv5-series</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Installing kubeadm <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Install Docker Engine on Ubuntu
<a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Quickstart for Calico on Kubernetes <a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart#install-calico">https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart#install-calico</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>Confidential Containers Operator Installation: <a href="https://github.com/confidential-containers/operator/blob/main/docs/INSTALL.md">https://github.com/confidential-containers/operator/blob/main/docs/INSTALL.md</a>&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p>Confidential Containers Operator Release Page <a href="https://github.com/confidential-containers/operator/releases">https://github.com/confidential-containers/operator/releases</a>&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://suraj.io/tags/kubernetes/">Kubernetes</a></li>
      <li><a href="https://suraj.io/tags/security/">Security</a></li>
      <li><a href="https://suraj.io/tags/coco/">Coco</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://suraj.io/post/surajd-talks-links/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Suraj Deshmukh&#39;s talks at conferences</span>
  </a>
  <a class="next" href="https://suraj.io/post/2021/10/dont-be-default/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Fight Your Instincts ‚Äî Your Default Behaviour is Hurting You</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on x"
            href="https://x.com/intent/tweet/?text=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f&amp;hashtags=kubernetes%2csecurity%2ccoco">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f&amp;title=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure&amp;summary=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure&amp;source=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f&title=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on whatsapp"
            href="https://api.whatsapp.com/send?text=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure%20-%20https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on telegram"
            href="https://telegram.me/share/url?text=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Open Source Confidential Containers (CoCo) on Azure on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Open%20Source%20Confidential%20Containers%20%28CoCo%29%20on%20Azure&u=https%3a%2f%2fsuraj.io%2fpost%2f2024%2fcoco-on-azure%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "suraj-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://suraj.io/">Suraj Deshmukh</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
