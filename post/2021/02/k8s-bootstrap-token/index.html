<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Enable TLS bootstrapping in a Kubernetes cluster | Suraj Deshmukh</title>
<meta name="keywords" content="kubernetes, notes, certs">
<meta name="description" content="Add a new node using a bootstrap token to Kubernetes">
<meta name="author" content="Suraj Deshmukh">
<link rel="canonical" href="https://suraj.io/post/2021/02/k8s-bootstrap-token/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://suraj.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://suraj.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://suraj.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://suraj.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://suraj.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://suraj.io/post/2021/02/k8s-bootstrap-token/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-97006720-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Enable TLS bootstrapping in a Kubernetes cluster" />
<meta property="og:description" content="Add a new node using a bootstrap token to Kubernetes" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://suraj.io/post/2021/02/k8s-bootstrap-token/" />
<meta property="og:image" content="https://suraj.io/post/2021/02/k8s-bootstrap-token/rack.jpg" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-02-06T10:25:41+05:30" />
<meta property="article:modified_time" content="2021-02-06T10:25:41+05:30" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://suraj.io/post/2021/02/k8s-bootstrap-token/rack.jpg" />
<meta name="twitter:title" content="Enable TLS bootstrapping in a Kubernetes cluster"/>
<meta name="twitter:description" content="Add a new node using a bootstrap token to Kubernetes"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://suraj.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Enable TLS bootstrapping in a Kubernetes cluster",
      "item": "https://suraj.io/post/2021/02/k8s-bootstrap-token/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Enable TLS bootstrapping in a Kubernetes cluster",
  "name": "Enable TLS bootstrapping in a Kubernetes cluster",
  "description": "Add a new node using a bootstrap token to Kubernetes",
  "keywords": [
    "kubernetes", "notes", "certs"
  ],
  "articleBody": "This blog is a recap of my old blog ‚ÄúAdd new node to Kubernetes cluster with bootstrap token‚Äù. Like the aforementioned blog, we will look at how to enable TLS bootstrapping on an existing Kubernetes cluster at control plane level and add a new node (or modify existing ones) to the cluster using bootstrap tokens. At the end of this blog, you will learn what specific steps to take to enable TLS bootstrapping on any custom-built Kubernetes cluster.\nTextual 1. Kubernetes Cluster If you have a cluster running, you can skip this step. To demonstrate how TLS bootstrap tokens work, I have brought up a cluster using Kubernetes the Hard Way (Vagrant). This section shows how to bring up a multi-node, multi-worker Kubernetes cluster quickly.\n1.1. Setup Machine I am running this setup on a Ubuntu 20.04 machine. Install virtual-box and vagrant by executing the following commands as the root user:\napt-get update \u0026\u0026 \\ apt-get -y upgrade \u0026\u0026 \\ apt-get install -y make git byobu linux-generic systemctl reboot apt-get install -y linux-headers-`uname -r` \u0026\u0026 \\ apt install -y virtualbox \u0026\u0026 \\ apt-get install -y vagrant \u0026\u0026 \\ dpkg-reconfigure virtualbox-dkms 1.2. Clone the Repository mkdir -p git/kubernetes-the-hard-way-vagrant git clone https://github.com/kinvolk/kubernetes-the-hard-way-vagrant git/kubernetes-the-hard-way-vagrant cd git/kubernetes-the-hard-way-vagrant 1.3. Install the Cluster ./scripts/install-tools ./scripts/setup 1.4. Verify the Cluster Installation kubectl get nodes 2. Prepare Control Plane 2.1. Setup RBAC When a new node tries to authenticate to the control plane, the only credential used is a bootstrap token. Such a node client (kubelet) is a member of group system:bootstrappers, we need to ensure that such a client has permissions to create Certificate Signing Requests (CSRs), get them approved, renew them, etc. The following ClusterRoleBindings will ensure that these nodes join without authorisation issues. This setting needs to be done only once and does not change from node-to-node.\nRun the following command to create the bindings that will allow the new nodes to connect to the cluster:\ncat \u003c",
  "wordCount" : "854",
  "inLanguage": "en",
  "image":"https://suraj.io/post/2021/02/k8s-bootstrap-token/rack.jpg","datePublished": "2021-02-06T10:25:41+05:30",
  "dateModified": "2021-02-06T10:25:41+05:30",
  "author":{
    "@type": "Person",
    "name": "Suraj Deshmukh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://suraj.io/post/2021/02/k8s-bootstrap-token/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Suraj Deshmukh",
    "logo": {
      "@type": "ImageObject",
      "url": "https://suraj.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://suraj.io/" accesskey="h" title="Suraj Deshmukh (Alt + H)">Suraj Deshmukh</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://suraj.io/post" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/archives" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/search" title="Search üîç">
                    <span>Search üîç</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://suraj.io/series" title="Series">
                    <span>Series</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://suraj.io/">Home</a>&nbsp;¬ª&nbsp;<a href="https://suraj.io/post/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Enable TLS bootstrapping in a Kubernetes cluster
    </h1>
    <div class="post-description">
      Add a new node using a bootstrap token to Kubernetes
    </div>
    <div class="post-meta"><span title='2021-02-06 10:25:41 +0530 +0530'>February 6, 2021</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Suraj Deshmukh&nbsp;|&nbsp;<a href="https://github.com/surajssd/blog_contents/blob/master/content/post/2021/02/k8s-bootstrap-token.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="https://suraj.io/post/2021/02/k8s-bootstrap-token/rack.jpg" alt="Bootstrap token">
        <p>Photo by <a href="https://unsplash.com/@jordanharrison?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Jordan Harrison</a> from <a href="https://unsplash.com">Unsplash</a>.</p>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#textual" aria-label="Textual">Textual</a><ul>
                        
                <li>
                    <a href="#1-kubernetes-cluster" aria-label="1. Kubernetes Cluster">1. Kubernetes Cluster</a><ul>
                        
                <li>
                    <a href="#11-setup-machine" aria-label="1.1. Setup Machine">1.1. Setup Machine</a></li>
                <li>
                    <a href="#12-clone-the-repository" aria-label="1.2. Clone the Repository">1.2. Clone the Repository</a></li>
                <li>
                    <a href="#13-install-the-cluster" aria-label="1.3. Install the Cluster">1.3. Install the Cluster</a></li>
                <li>
                    <a href="#14-verify-the-cluster-installation" aria-label="1.4. Verify the Cluster Installation">1.4. Verify the Cluster Installation</a></li></ul>
                </li>
                <li>
                    <a href="#2-prepare-control-plane" aria-label="2. Prepare Control Plane">2. Prepare Control Plane</a><ul>
                        
                <li>
                    <a href="#21-setup-rbac" aria-label="2.1. Setup RBAC">2.1. Setup RBAC</a></li>
                <li>
                    <a href="#22-modify-kubernetes-apiserver" aria-label="2.2. Modify Kubernetes Apiserver">2.2. Modify Kubernetes Apiserver</a></li>
                <li>
                    <a href="#23-modify-kubernetes-controller-manager" aria-label="2.3. Modify Kubernetes Controller Manager">2.3. Modify Kubernetes Controller Manager</a></li></ul>
                </li>
                <li>
                    <a href="#3-modify--add-workers" aria-label="3. Modify / Add Workers">3. Modify / Add Workers</a><ul>
                        
                <li>
                    <a href="#31-create-the-bootstrap-token" aria-label="3.1. Create the Bootstrap Token">3.1. Create the Bootstrap Token</a></li>
                <li>
                    <a href="#32-create-bootstrap-token-secret" aria-label="3.2. Create Bootstrap Token Secret">3.2. Create Bootstrap Token Secret</a></li>
                <li>
                    <a href="#33-create-bootstrap-kubeconfig-for-kubelets" aria-label="3.3. Create Bootstrap Kubeconfig for Kubelets">3.3. Create Bootstrap Kubeconfig for Kubelets</a></li>
                <li>
                    <a href="#34-modify-kubelet" aria-label="3.4. Modify Kubelet">3.4. Modify Kubelet</a></li></ul>
                </li>
                <li>
                    <a href="#4-verify" aria-label="4. Verify">4. Verify</a></li></ul>
                </li>
                <li>
                    <a href="#video" aria-label="Video">Video</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>This blog is a recap of my old blog <a href="https://suraj.io/post/add-new-k8s-node-bootstrap-token/">&ldquo;Add new node to Kubernetes cluster with bootstrap token&rdquo;</a>. Like the aforementioned blog, we will look at how to enable TLS bootstrapping on an existing Kubernetes cluster at control plane level and add a new node (or modify existing ones) to the cluster using bootstrap tokens. At the end of this blog, you will learn what specific steps to take to enable TLS bootstrapping on any custom-built Kubernetes cluster.</p>
<h1 id="textual">Textual<a hidden class="anchor" aria-hidden="true" href="#textual">#</a></h1>
<h2 id="1-kubernetes-cluster">1. Kubernetes Cluster<a hidden class="anchor" aria-hidden="true" href="#1-kubernetes-cluster">#</a></h2>
<p>If you have a cluster running, you can skip this step. To demonstrate how TLS bootstrap tokens work, I have brought up a cluster using <a href="https://github.com/kinvolk/kubernetes-the-hard-way-vagrant/">Kubernetes the Hard Way (Vagrant)</a>. This section shows how to bring up a multi-node, multi-worker Kubernetes cluster quickly.</p>
<h3 id="11-setup-machine">1.1. Setup Machine<a hidden class="anchor" aria-hidden="true" href="#11-setup-machine">#</a></h3>
<p>I am running this setup on a Ubuntu 20.04 machine. Install virtual-box and vagrant by executing the following commands as the <code>root</code> user:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>apt-get -y upgrade <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>apt-get install -y make git byobu linux-generic
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl reboot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apt-get install -y linux-headers-<span class="sb">`</span>uname -r<span class="sb">`</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>apt install -y virtualbox <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>apt-get install -y vagrant <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>dpkg-reconfigure virtualbox-dkms
</span></span></code></pre></div><h3 id="12-clone-the-repository">1.2. Clone the Repository<a hidden class="anchor" aria-hidden="true" href="#12-clone-the-repository">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p git/kubernetes-the-hard-way-vagrant
</span></span><span class="line"><span class="cl">git clone https://github.com/kinvolk/kubernetes-the-hard-way-vagrant git/kubernetes-the-hard-way-vagrant
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> git/kubernetes-the-hard-way-vagrant
</span></span></code></pre></div><h3 id="13-install-the-cluster">1.3. Install the Cluster<a hidden class="anchor" aria-hidden="true" href="#13-install-the-cluster">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./scripts/install-tools
</span></span><span class="line"><span class="cl">./scripts/setup
</span></span></code></pre></div><h3 id="14-verify-the-cluster-installation">1.4. Verify the Cluster Installation<a hidden class="anchor" aria-hidden="true" href="#14-verify-the-cluster-installation">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get nodes
</span></span></code></pre></div><h2 id="2-prepare-control-plane">2. Prepare Control Plane<a hidden class="anchor" aria-hidden="true" href="#2-prepare-control-plane">#</a></h2>
<h3 id="21-setup-rbac">2.1. Setup RBAC<a hidden class="anchor" aria-hidden="true" href="#21-setup-rbac">#</a></h3>
<p>When a new node tries to authenticate to the control plane, the only credential used is a bootstrap token. Such a node client (kubelet) is a member of group <code>system:bootstrappers</code>, we need to ensure that such a client has permissions to create Certificate Signing Requests (CSRs), get them approved, renew them, etc. The following ClusterRoleBindings will ensure that these nodes join without authorisation issues. This setting needs to be done only once and does not change from node-to-node.</p>
<p>Run the following command to create the bindings that will allow the new nodes to connect to the cluster:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">cat &lt;&lt;EOF | kubectl apply -f -</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Enable bootstrapping nodes to create CSR.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">create-bootstrapping-csr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Group</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:bootstrappers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:node-bootstrapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Approve all CSRs for the group &#34;system:bootstrappers&#34;.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">approve-csrs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Group</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:bootstrappers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:certificates.k8s.io:certificatesigningrequests:nodeclient</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Approve renewal CSRs for the group &#34;system:nodes&#34;.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">approve-node-renewals</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Group</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:nodes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">system:certificates.k8s.io:certificatesigningrequests:selfnodeclient</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">EOF</span><span class="w">
</span></span></span></code></pre></div><h3 id="22-modify-kubernetes-apiserver">2.2. Modify Kubernetes Apiserver<a hidden class="anchor" aria-hidden="true" href="#22-modify-kubernetes-apiserver">#</a></h3>
<p>Add the following set of flags to the <code>kube-apiserver</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">--authorization-mode<span class="o">=</span>Node,RBAC
</span></span><span class="line"><span class="cl">--enable-bootstrap-token-auth<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></div><p>Above setting needs to be performed on each control plane node.</p>
<h3 id="23-modify-kubernetes-controller-manager">2.3. Modify Kubernetes Controller Manager<a hidden class="anchor" aria-hidden="true" href="#23-modify-kubernetes-controller-manager">#</a></h3>
<p>Add the following flag to the <code>kube-controller-manager</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">--controllers<span class="o">=</span>*,tokencleaner,bootstrapsigner
</span></span></code></pre></div><p>Above setting needs to be performed on each control plane node.</p>
<h2 id="3-modify--add-workers">3. Modify / Add Workers<a hidden class="anchor" aria-hidden="true" href="#3-modify--add-workers">#</a></h2>
<h3 id="31-create-the-bootstrap-token">3.1. Create the Bootstrap Token<a hidden class="anchor" aria-hidden="true" href="#31-create-the-bootstrap-token">#</a></h3>
<p>Please note these tokens, we will need them in two places. One, while creating a bootstrap-token embedded Kubernetes Secret object and another in the bootstrap kubeconfig for the Kubelet:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">TOKEN_ID</span><span class="o">=</span><span class="k">$(</span>openssl rand -hex 3<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">TOKEN_SECRET</span><span class="o">=</span><span class="k">$(</span>openssl rand -hex 8<span class="k">)</span>
</span></span></code></pre></div><h3 id="32-create-bootstrap-token-secret">3.2. Create Bootstrap Token Secret<a hidden class="anchor" aria-hidden="true" href="#32-create-bootstrap-token-secret">#</a></h3>
<p>Kubernetes apiserver will use this secret to identify the node that is joining the cluster. Execute the following command to create the secret embedding the previously generated tokens:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">cat &lt;&lt;EOF | kubectl apply -f -</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">bootstrap.kubernetes.io/token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bootstrap-token-$TOKEN_ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stringData</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Manually generated bootstrap token.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">token-id</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$TOKEN_ID&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">token-secret</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$TOKEN_SECRET&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">usage-bootstrap-authentication</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">usage-bootstrap-signing</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">EOF</span><span class="w">
</span></span></span></code></pre></div><h3 id="33-create-bootstrap-kubeconfig-for-kubelets">3.3. Create Bootstrap Kubeconfig for Kubelets<a hidden class="anchor" aria-hidden="true" href="#33-create-bootstrap-kubeconfig-for-kubelets">#</a></h3>
<p>Create bootstrap Kubeconfig for Kubelet(s):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">SERVER</span><span class="o">=</span><span class="k">$(</span>kubectl config view -ojsonpath<span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.server}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">CA_CERT</span><span class="o">=</span><span class="k">$(</span>kubectl config view --flatten -ojsonpath<span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.certificate-authority-data}&#39;</span><span class="k">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">cat &lt;&lt;EOF | tee kubeconfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cluster</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$SERVER&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">certificate-authority-data</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$CA_CERT&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">users</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$TOKEN_ID.$TOKEN_SECRET&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">EOF</span><span class="w">
</span></span></span></code></pre></div><p>Keep this file around it will be needed to connect worker(s) node using bootstrap token to control plane.</p>
<h3 id="34-modify-kubelet">3.4. Modify Kubelet<a hidden class="anchor" aria-hidden="true" href="#34-modify-kubelet">#</a></h3>
<p>Copy the bootstrap kubeconfig created in step 3.3 to the worker node you want to connect to control plane using bootstrap tokens. Save the kubeconfig on the node and provide the path to that file to flag <code>--bootstrap-kubeconfig</code>. The path supplied to <code>--kubeconfig</code> will have newly downloaded kubeconfig once the kubelet authenticates with the kube-apiserver.</p>
<p>Add the following set of flags to the <code>kubelet</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">--kubeconfig<span class="o">=</span>/var/lib/kubelet/kubeconfig
</span></span><span class="line"><span class="cl">--bootstrap-kubeconfig<span class="o">=</span>/etc/kubernetes/kubeconfig
</span></span><span class="line"><span class="cl">--rotate-certificates
</span></span></code></pre></div><p><strong>NOTE:</strong> You can remove the file in <code>/var/lib/kubelet/kubeconfig</code>, especially if you modify an existing worker node, to ensure that Kubelet downloads the new kubeconfig at that location.</p>
<p>You can have a separate token for each worker node to reduce the attack surface. To generate distinct token repeat steps 3.1 to 3.4 for each worker node. But if you wish to use the same token for each worker node, repeat step 3.4 on each worker.</p>
<h2 id="4-verify">4. Verify<a hidden class="anchor" aria-hidden="true" href="#4-verify">#</a></h2>
<p>Ensure that the node has joined the control plane using TLS bootstrap token by executing the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get nodes
</span></span></code></pre></div><h1 id="video">Video<a hidden class="anchor" aria-hidden="true" href="#video">#</a></h1>
<p>Watch this video to understand the same process explained in this blog. Unlike my previous blog videos, I am narrating, so you know what is going on.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/RpBHoAmBBYY" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">Authenticating with Bootstrap Tokens</a>.</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://suraj.io/tags/kubernetes/">Kubernetes</a></li>
      <li><a href="https://suraj.io/tags/notes/">Notes</a></li>
      <li><a href="https://suraj.io/tags/certs/">Certs</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://suraj.io/post/2021/02/book-hiw-learnings/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Book: How Innovation Works</span>
  </a>
  <a class="next" href="https://suraj.io/post/2021/01/kubeadm-flatcar/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Kubernetes Cluster using Kubeadm on Flatcar Container Linux</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on x"
            href="https://x.com/intent/tweet/?text=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f&amp;hashtags=kubernetes%2cnotes%2ccerts">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f&amp;title=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster&amp;summary=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster&amp;source=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f&title=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on whatsapp"
            href="https://api.whatsapp.com/send?text=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster%20-%20https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on telegram"
            href="https://telegram.me/share/url?text=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Enable TLS bootstrapping in a Kubernetes cluster on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Enable%20TLS%20bootstrapping%20in%20a%20Kubernetes%20cluster&u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f02%2fk8s-bootstrap-token%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "suraj-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://suraj.io/">Suraj Deshmukh</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
