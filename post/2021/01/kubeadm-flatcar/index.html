<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Kubernetes Cluster using Kubeadm on Flatcar Container Linux - Suraj Deshmukh</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.80.0" /><meta property="og:site_name" content="Suraj Deshmukh">
  <meta property="og:title" content="Kubernetes Cluster using Kubeadm on Flatcar Container Linux">
  <meta property="og:description" content="Simple steps to install the cluster based on Flatcar Container Linux">
  <meta property="description" content="Simple steps to install the cluster based on Flatcar Container Linux">
  <meta property="og:url" content="https://suraj.io/post/2021/01/kubeadm-flatcar/">
  <meta property="og:type" content="article">
  
    <meta property="og:image" content="https://github.com/surajssd.png">
  
  
            <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/github.min.css">
          <link rel="stylesheet" href="/css/bundle.min.307f33cd8015e5bab28d6ebda9b400f8d3059bc248b4e60adf4d23469fab5a2b.css" integrity="sha256-MH8zzYAV5bqyjW69qbQA&#43;NMFm8JItOYK300jRp&#43;rWis="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Kubernetes Cluster using Kubeadm on Flatcar Container Linux
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about/" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/post/" class="nav link"><i class='far fa-newspaper'></i> Blog</a>
        
      
        
          
          <a href="/categories/" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
        
      
      <a href="#share-menu" class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active">English (en)</a>
  
    
      
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f&amp;title=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f&amp;title=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Suraj%20Deshmukh&amp;body=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="https://github.com/surajssd.png" class="square" width="100" alt="Suraj Deshmukh" /></a>
  <header>
    <h1>Blog</h1>
  </header>
  <main>
    <p>containers, packaging, programming, hacks, kubernetes, openshift, fedora, centos</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/surajssd" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/3848679/surajd" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>







<li><a href="//deshmukhsuraj.wordpress.com" target="_blank" rel="noopener" title="WordPress" class="fab fa-wordpress"></a></li>

<li><a href="//www.linkedin.com/in/suraj-deshmukh-0205b834" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>



<li><a href="//slideshare.com/surajssd009005" target="_blank" rel="noopener" title="SlideShare" class="fab fa-slideshare"></a></li>



<li><a href="//youtube.com/surajssd009005" target="_blank" rel="noopener" title="YouTube" class="fab fa-youtube"></a></li>







<li><a href="//twitter.com/surajd_" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>











<li><a href="mailto:surajd.service@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article>
    <div class="post">
      <header>
  <div class="title">
    
      <h2><a href="/post/2021/01/kubeadm-flatcar/">Kubernetes Cluster using Kubeadm on Flatcar Container Linux</a></h2>
    
    
      <p>Simple steps to install the cluster based on Flatcar Container Linux</p>
    
  </div>
  <div class="meta">
    <time datetime="2021-01-29 22:02:41 &#43;0530 IST">January 29, 2021</time>
    <p>Suraj Deshmukh</p>
    <p>4-Minute Read</p>
  </div>
</header>

      <div id="socnet-share">
        




  
    
    <a href="//twitter.com/share?text=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux&amp;url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f&amp;title=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f&amp;title=Kubernetes%20Cluster%20using%20Kubeadm%20on%20Flatcar%20Container%20Linux" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Suraj%20Deshmukh&amp;body=https%3a%2f%2fsuraj.io%2fpost%2f2021%2f01%2fkubeadm-flatcar%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


      </div>
      <div class="content">
        
        <p>This blog shows a simple set of commands to install a Kubernetes cluster on <a href="https://www.flatcar-linux.org/">Flatcar Container Linux</a> based machines using <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/">Kubeadm</a>.</p>
<p>You might wonder why this blog when one can go to the official documentation and follow the steps? Yep, you are right. You can choose to do that. But this blog has a collection of actions specific to Flatcar Container Linux. These steps have been tried and tested on Flatcar, so you don&rsquo;t need to recreate and test them yourself. There are some nuances related to the read-only partitions of Flatcar, and this blog takes care of them at the control plane level and the CNI level both.</p>
<p><img src="https://kinvolk.io/media/flatcar-linux-public-release_huff9ce14b9fc0c4cb57265a53fd2259cb_16308_900x0_resize_box_2.png" alt="Flatcar Container Linux" title="Flatcar Container Linux"></p>
<h1 id="textual-steps">Textual Steps</h1>
<p>All the commands are run by becoming <code>root</code> using <code>sudo -i</code>.</p>
<h2 id="1-setup-nodes">1. Setup Nodes</h2>
<p>All the following sub-steps should be run all the nodes.</p>
<h3 id="11-setup-networking">1.1. Setup Networking</h3>
<pre><code>systemctl enable docker
modprobe br_netfilter

cat &lt;&lt;EOF | tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

cat &lt;&lt;EOF | tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
</code></pre><h3 id="12-download-binaries-and-start-kubelet">1.2. Download binaries and start Kubelet</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CNI_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v0.8.2&#34;</span>
CRICTL_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v1.17.0&#34;</span>
RELEASE_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v0.4.0&#34;</span>
DOWNLOAD_DIR<span style="color:#f92672">=</span>/opt/bin
RELEASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -sSL https://dl.k8s.io/release/stable.txt<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>

mkdir -p /opt/cni/bin
mkdir -p /etc/systemd/system/kubelet.service.d

alias curl<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;curl -sSL&#39;</span>
curl <span style="color:#e6db74">&#34;https://github.com/containernetworking/plugins/releases/download/</span><span style="color:#e6db74">${</span>CNI_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/cni-plugins-linux-amd64-</span><span style="color:#e6db74">${</span>CNI_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">.tgz&#34;</span> | tar -C /opt/cni/bin -xz
curl <span style="color:#e6db74">&#34;https://github.com/kubernetes-sigs/cri-tools/releases/download/</span><span style="color:#e6db74">${</span>CRICTL_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/crictl-</span><span style="color:#e6db74">${</span>CRICTL_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">-linux-amd64.tar.gz&#34;</span> | tar -C $DOWNLOAD_DIR -xz
curl <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/kubernetes/release/</span><span style="color:#e6db74">${</span>RELEASE_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service&#34;</span> | sed <span style="color:#e6db74">&#34;s:/usr/bin:</span><span style="color:#e6db74">${</span>DOWNLOAD_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">:g&#34;</span> | tee /etc/systemd/system/kubelet.service
curl <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/kubernetes/release/</span><span style="color:#e6db74">${</span>RELEASE_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf&#34;</span> | sed <span style="color:#e6db74">&#34;s:/usr/bin:</span><span style="color:#e6db74">${</span>DOWNLOAD_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">:g&#34;</span> | tee /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
curl --remote-name-all https://storage.googleapis.com/kubernetes-release/release/<span style="color:#e6db74">${</span>RELEASE<span style="color:#e6db74">}</span>/bin/linux/amd64/<span style="color:#f92672">{</span>kubeadm,kubelet,kubectl<span style="color:#f92672">}</span>

chmod +x <span style="color:#f92672">{</span>kubeadm,kubelet,kubectl<span style="color:#f92672">}</span>
mv <span style="color:#f92672">{</span>kubeadm,kubelet,kubectl<span style="color:#f92672">}</span> $DOWNLOAD_DIR/

systemctl enable --now kubelet
systemctl status kubelet
</code></pre></div><h3 id="13-update-flatcar">1.3. Update Flatcar</h3>
<p>Verify if you need to update Flatcar by running the following two commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -sSL https://stable.release.flatcar-linux.net/amd64-usr/current/version.txt | grep FLATCAR_VERSION
cat /etc/os-release | grep VERSION
</code></pre></div><p>If the output of the above two commands match, your Flatcar is already up to date, you don&rsquo;t need to run the following commands.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">update_engine_client -update
systemctl reboot
</code></pre></div><h2 id="2-setup-controller-node">2. Setup Controller Node</h2>
<p>Run these steps only on the controller node.</p>
<h3 id="21-initialise-kubeadm">2.1. Initialise Kubeadm</h3>
<p>Here we are ensuring that the Kubelet volume-plugins directory is writable, the default path used is under <code>/usr</code> which is read-only on Flatcar, therefore we are setting it to writable path <code>/opt/libexec/kubernetes/kubelet-plugins/volume/exec/</code>.</p>
<p>From the <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#usr-mounted-read-only">kubeadm docs</a>:</p>
<blockquote>
<p>On Linux distributions such as Flatcar Container Linux, the directory <code>/usr</code> is mounted as a read-only filesystem. For flex-volume support, Kubernetes components like the kubelet and kube-controller-manager use the default path of <code>/usr/libexec/kubernetes/kubelet-plugins/volume/exec/</code>, yet the flex-volume directory <strong>must be writeable</strong> for the feature to work.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">cat &lt;&lt;EOF | tee kubeadm-config.yaml</span>
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">InitConfiguration</span>
<span style="color:#f92672">nodeRegistration</span>:
  <span style="color:#f92672">kubeletExtraArgs</span>:
    <span style="color:#f92672">volume-plugin-dir</span>: <span style="color:#e6db74">&#34;/opt/libexec/kubernetes/kubelet-plugins/volume/exec/&#34;</span>
---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterConfiguration</span>
<span style="color:#f92672">networking</span>:
  <span style="color:#f92672">podSubnet</span>: <span style="color:#ae81ff">192.168.0.0</span><span style="color:#ae81ff">/16</span>
<span style="color:#f92672">controllerManager</span>:
  <span style="color:#f92672">extraArgs</span>:
    <span style="color:#f92672">flex-volume-plugin-dir</span>: <span style="color:#e6db74">&#34;/opt/libexec/kubernetes/kubelet-plugins/volume/exec/&#34;</span>
<span style="color:#ae81ff">EOF</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubeadm config images pull
kubeadm init --config kubeadm-config.yaml

mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</code></pre></div><h3 id="22-install-cni">2.2. Install CNI</h3>
<p>Here I have chosen <a href="https://www.projectcalico.org/">Calico</a> as the CNI to install because it is the one that I am familiar with, but you can choose to install any <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model">other CNI</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">cat &lt;&lt;EOF | tee calico.yaml</span>
<span style="color:#75715e"># Source: https://docs.projectcalico.org/manifests/custom-resources.yaml</span>
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">operator.tigera.io/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Installation</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">default</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#75715e"># Configures Calico networking.</span>
  <span style="color:#f92672">calicoNetwork</span>:
    <span style="color:#75715e"># Note: The ipPools section cannot be modified post-install.</span>
    <span style="color:#f92672">ipPools</span>:
    - <span style="color:#f92672">blockSize</span>: <span style="color:#ae81ff">26</span>
      <span style="color:#f92672">cidr</span>: <span style="color:#ae81ff">192.168.0.0</span><span style="color:#ae81ff">/16</span>
      <span style="color:#f92672">encapsulation</span>: <span style="color:#ae81ff">VXLANCrossSubnet</span>
      <span style="color:#f92672">natOutgoing</span>: <span style="color:#ae81ff">Enabled</span>
      <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">all()</span>
  <span style="color:#f92672">flexVolumePath</span>: <span style="color:#ae81ff">/opt/libexec/kubernetes/kubelet-plugins/volume/exec/</span>
<span style="color:#ae81ff">EOF</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create -f https://docs.projectcalico.org/manifests/tigera-operator.yaml
kubectl apply -f calico.yaml
kubectl taint nodes --all node-role.kubernetes.io/master-
kubectl get pods -A
kubectl get nodes -o wide
</code></pre></div><h3 id="23-generate-worker-config">2.3. Generate worker config</h3>
<p>The general way to connect a worker to the control plane is by running the <code>kubeadm join</code> command generated at the end of the <code>kubeadm init</code> output. But you can run the following set of steps at any time to create a worker config.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">URL<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl config view -ojsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.clusters[0].cluster.server}&#39;</span><span style="color:#66d9ef">)</span>
prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://&#34;</span>
short_url<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>URL#<span style="color:#e6db74">&#34;</span>$prefix<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">cat &lt;&lt;EOF</span>
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">JoinConfiguration</span>
<span style="color:#f92672">discovery</span>:
  <span style="color:#f92672">bootstrapToken</span>:
    <span style="color:#f92672">apiServerEndpoint</span>: <span style="color:#ae81ff">$short_url</span>
    <span style="color:#f92672">token</span>: <span style="color:#ae81ff">$(kubeadm token create)</span>
    <span style="color:#f92672">caCertHashes</span>:
    - <span style="color:#ae81ff">sha256:$(openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;)</span>
<span style="color:#f92672">controlPlane</span>:
<span style="color:#f92672">nodeRegistration</span>:
  <span style="color:#f92672">kubeletExtraArgs</span>:
    <span style="color:#f92672">volume-plugin-dir</span>: <span style="color:#e6db74">&#34;/opt/libexec/kubernetes/kubelet-plugins/volume/exec/&#34;</span>
<span style="color:#ae81ff">EOF</span>
</code></pre></div><p>Copy the generated config to worker nodes and save it in a file named <code>worker-config.yaml</code>.</p>
<h2 id="3-join-workers-to-controllers">3. Join Workers to Controllers</h2>
<p>Run the following steps only on worker nodes.</p>
<h3 id="31-connect-to-control-plane">3.1. Connect to Control-Plane</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubeadm join --config worker-config.yaml
</code></pre></div><h2 id="4-verify">4. Verify</h2>
<p>Go to the controller node and run the command <code>kubectl get nodes</code> to verify if the worker has joined the cluster.</p>
<h1 id="video">Video</h1>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/wxa1fTDNcis" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="references">References</h1>
<ul>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a>.</li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Creating a cluster with kubeadm</a>.</li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/">Troubleshooting kubeadm</a>.</li>
<li><a href="https://pkg.go.dev/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2">Kubeadm configuration reference</a>.</li>
<li><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/#token-based-discovery-with-ca-pinning">Manually generating discovery-token-ca-cert-hash</a>.</li>
<li><a href="https://docs.projectcalico.org/getting-started/kubernetes/quickstart">Quickstart for Calico on Kubernetes</a>.</li>
</ul>

      </div>
      <footer>
        <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/kubernetes/">kubernetes</a></li>
        
          <li><a class="article-terms-link" href="/categories/flatcar/">flatcar</a></li>
        
          <li><a class="article-terms-link" href="/categories/containers/">containers</a></li>
        
          <li><a class="article-terms-link" href="/categories/kubeadm/">kubeadm</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/kubernetes/">kubernetes</a></li>
        
          <li><a class="article-terms-link" href="/tags/flatcar/">flatcar</a></li>
        
          <li><a class="article-terms-link" href="/tags/containers/">containers</a></li>
        
          <li><a class="article-terms-link" href="/tags/kubeadm/">kubeadm</a></li>
        
      
    </ul>
  
</div>

      </footer>
    </div>
    
      
  <div class='post'>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "suraj-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>



    
  </article>
  <div class="pagination">
    
      <a href="/post/2021/02/k8s-bootstrap-token/" class="button left"><span>Enable TLS bootstrapping in a Kubernetes cluster</span></a>
    
    
      <a href="/post/2021/01/shell-exec/" class="button right"><span>Exec in container environment</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          <a href="/post/2021/05/self-sign-k8s-cert/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/self-sign-k8s-cert/cert.png');">
    <img src="https://suraj.io/post/2021/05/self-sign-k8s-cert/cert.png" alt="cert">
  </a>
        <header>
          <h2><a href="/post/2021/05/self-sign-k8s-cert/">How to generate a self-signed TLS certificate for Kubernetes Admission Webhook Servers?</a></h2>
          <time class="published" datetime="2021-05-21 15:33:07 &#43;0530 IST">May 21, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/05/learnings-psychology-of-money/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/learnings-psychology-of-money/logo.jpg');">
    <img src="https://suraj.io/post/2021/05/learnings-psychology-of-money/logo.jpg" alt="TPOM">
  </a>
        <header>
          <h2><a href="/post/2021/05/learnings-psychology-of-money/">Learnings from &#39;The Psychology of Money&#39;</a></h2>
          <time class="published" datetime="2021-05-20 12:15:07 &#43;0530 IST">May 20, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/05/access-k8s-secrets-mitigation/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/access-k8s-secrets-mitigation/config.png');">
    <img src="https://suraj.io/post/2021/05/access-k8s-secrets-mitigation/config.png" alt="Config">
  </a>
        <header>
          <h2><a href="/post/2021/05/access-k8s-secrets-mitigation/">Mitigation of: Access Any Kubernetes Secret</a></h2>
          <time class="published" datetime="2021-05-20 08:47:07 &#43;0530 IST">May 20, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/05/access-k8s-secrets/" class="image" style="--bg-image: url('https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg');">
    <img src="https://suraj.io/post/2021/05/access-k8s-secrets/forbidden.jpg" alt="Forbidden">
  </a>
        <header>
          <h2><a href="/post/2021/05/access-k8s-secrets/">Access Any Kubernetes Secret</a></h2>
          <time class="published" datetime="2021-05-08 12:17:07 &#43;0530 IST">May 8, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/post/2021/04/rituals-dont-scale/" class="image" style="--bg-image: url('https://suraj.io/post/2021/04/rituals-dont-scale/earth.jpg');">
    <img src="https://suraj.io/post/2021/04/rituals-dont-scale/earth.jpg" alt="Earth">
  </a>
        <header>
          <h2><a href="/post/2021/04/rituals-dont-scale/">Religious Rituals Don&#39;t Scale With Population</a></h2>
          <time class="published" datetime="2021-04-12 07:07:07 &#43;0530 IST">April 12, 2021</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/post/" class="button">See More</a>
        </footer>
      
    </section>
  

  
    

      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
          
          <li>
              <a href="/categories/kubernetes/">kubernetes<span class="count">31</span></a>
          
          <li>
              <a href="/categories/notes/">notes<span class="count">21</span></a>
          
          <li>
              <a href="/categories/non-tech/">non-tech<span class="count">12</span></a>
          
          <li>
              <a href="/categories/security/">security<span class="count">11</span></a>
          
          <li>
              <a href="/categories/productivity/">productivity<span class="count">8</span></a>
          
          <li>
              <a href="/categories/book-review/">book-review<span class="count">7</span></a>
          
          <li>
              <a href="/categories/containers/">containers<span class="count">7</span></a>
          
          <li>
              <a href="/categories/bash/">bash<span class="count">5</span></a>
          
          <li>
              <a href="/categories/event_report/">event_report<span class="count">5</span></a>
          
          <li>
              <a href="/categories/packaging/">packaging<span class="count">5</span></a>
          
          <li>
              <a href="/categories/docker/">docker<span class="count">4</span></a>
          
          <li>
              <a href="/categories/golang/">golang<span class="count">4</span></a>
          
          <li>
              <a href="/categories/host/">host<span class="count">4</span></a>
          
          <li>
              <a href="/categories/fedora/">fedora<span class="count">3</span></a>
          
          <li>
              <a href="/categories/kompose/">kompose<span class="count">3</span></a>
          
          <li>
              <a href="/categories/linux/">linux<span class="count">3</span></a>
          
          <li>
              <a href="/categories/monitoring/">monitoring<span class="count">3</span></a>
          
          <li>
              <a href="/categories/notion/">notion<span class="count">3</span></a>
          
          <li>
              <a href="/categories/openshift/">openshift<span class="count">3</span></a>
          
          <li>
              <a href="/categories/programming/">programming<span class="count">3</span></a>
          
          <li>
              <a href="/categories/prometheus/">prometheus<span class="count">3</span></a>
          
          <li>
              <a href="/categories/certs/">certs<span class="count">2</span></a>
          
          <li>
              <a href="/categories/cka/">cka<span class="count">2</span></a>
          
          <li>
              <a href="/categories/configuration/">configuration<span class="count">2</span></a>
          
          <li>
              <a href="/categories/desktop/">desktop<span class="count">2</span></a>
          
          <li>
              <a href="/categories/git/">git<span class="count">2</span></a>
          
          <li>
              <a href="/categories/ide/">ide<span class="count">2</span></a>
          
          <li>
              <a href="/categories/kms/">kms<span class="count">2</span></a>
          
          <li>
              <a href="/categories/minikube/">minikube<span class="count">2</span></a>
          
          <li>
              <a href="/categories/activism/">activism<span class="count">1</span></a>
          
          <li>
              <a href="/categories/backup/">backup<span class="count">1</span></a>
          
          <li>
              <a href="/categories/centos/">centos<span class="count">1</span></a>
          
          <li>
              <a href="/categories/cmd-line/">cmd-line<span class="count">1</span></a>
          
          <li>
              <a href="/categories/etcd/">etcd<span class="count">1</span></a>
          
          <li>
              <a href="/categories/flatcar/">flatcar<span class="count">1</span></a>
          
          <li>
              <a href="/categories/gaming/">gaming<span class="count">1</span></a>
          
          <li>
              <a href="/categories/gnome/">gnome<span class="count">1</span></a>
          
          <li>
              <a href="/categories/https/">https<span class="count">1</span></a>
          
          <li>
              <a href="/categories/jobs/">jobs<span class="count">1</span></a>
          
          <li>
              <a href="/categories/kubeadm/">kubeadm<span class="count">1</span></a>
          
          <li>
              <a href="/categories/lokomotive/">lokomotive<span class="count">1</span></a>
          
          <li>
              <a href="/categories/meetup/">meetup<span class="count">1</span></a>
          
          <li>
              <a href="/categories/project_management/">project_management<span class="count">1</span></a>
          
          <li>
              <a href="/categories/selinux/">selinux<span class="count">1</span></a>
          
          <li>
              <a href="/categories/talks/">talks<span class="count">1</span></a>
          
          <li>
              <a href="/categories/vagrant/">vagrant<span class="count">1</span></a>
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>I am a Software Engineer at Kinvolk, working on various tooling around container technology like Docker, Kubernetes.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/surajssd" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/3848679/surajd" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>







<li><a href="//deshmukhsuraj.wordpress.com" target="_blank" rel="noopener" title="WordPress" class="fab fa-wordpress"></a></li>

<li><a href="//www.linkedin.com/in/suraj-deshmukh-0205b834" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>



<li><a href="//slideshare.com/surajssd009005" target="_blank" rel="noopener" title="SlideShare" class="fab fa-slideshare"></a></li>



<li><a href="//youtube.com/surajssd009005" target="_blank" rel="noopener" title="YouTube" class="fab fa-youtube"></a></li>







<li><a href="//twitter.com/surajd_" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>











<li><a href="mailto:surajd.service@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    Â© 2021 Suraj Deshmukh
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.80.0' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/html.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/css.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/js.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/toml.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/shell.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/bash.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script><script src="/js/bundle.min.3b56a9b984cfa78fed3a7843ad11f8065f52c7e64e6871ad2fe9729ed30d5c4f.js" integrity="sha256-O1apuYTPp4/tOnhDrRH4Bl9Sx&#43;ZOaHGtL&#43;lyntMNXE8="></script>
    <script src="/js/add-on.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-97006720-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
  </body>
</html>
